2025-09-27 14:59:13,740 - INFO - ğŸ“ Logging to file: /sql-scripts/logs/2024-09,2024-10,2024-11,2024-12,2025-01,2025-02,2025-03,2025-04,2025-05,2025-06,2025-07,2025-08/log_20250927_145913.log
2025-09-27 14:59:13,741 - INFO - ğŸ•’ Execution started at: 2025-09-27T14:59:13.741223
2025-09-27 14:59:13,741 - INFO - âš™ï¸ Backfill configuration: 2024-09,2024-10,2024-11,2024-12,2025-01,2025-02,2025-03,2025-04,2025-05,2025-06,2025-07,2025-08
2025-09-27 14:59:13,741 - INFO - ğŸš€ Starting Complete NYC Taxi Database Initialization...
2025-09-27 14:59:13,746 - INFO - âœ… PostgreSQL is ready!
2025-09-27 14:59:13,749 - INFO - ğŸ”§ Step 1: Database Schema Creation
2025-09-27 14:59:13,749 - INFO - ğŸ—ƒï¸ Executing SQL initialization scripts...
2025-09-27 14:59:13,751 - INFO - ğŸ“„ Found 2 SQL scripts to execute
2025-09-27 14:59:13,755 - INFO - ğŸ”§ Executing: 00-postgis-setup.sql
2025-09-27 14:59:13,758 - INFO - âœ… Completed: 00-postgis-setup.sql
2025-09-27 14:59:13,759 - INFO - ğŸ”§ Executing: 01-nyc-taxi-schema.sql
2025-09-27 14:59:14,036 - INFO - âœ… Completed: 01-nyc-taxi-schema.sql
2025-09-27 14:59:14,036 - INFO - âœ… All SQL scripts executed successfully!
2025-09-27 14:59:14,037 - INFO - ğŸ“ Step 2: Loading Taxi Zone Reference Data
2025-09-27 14:59:14,037 - INFO - ğŸ“ Loading taxi zone reference data...
2025-09-27 14:59:14,037 - INFO - ğŸ§¹ Cleaning dictionary tables for fresh data load...
2025-09-27 14:59:14,059 - INFO - âœ… Dictionary tables cleaned
2025-09-27 14:59:14,060 - INFO - ğŸ“¥ Downloading taxi zone reference data...
2025-09-27 14:59:14,060 - INFO - ğŸ“¥ Downloading taxi zone reference data...
2025-09-27 14:59:14,062 - INFO - ğŸ“¥ Downloading taxi_zone_lookup.csv...
2025-09-27 14:59:14,160 - INFO - âœ… Downloaded: taxi_zone_lookup.csv
2025-09-27 14:59:14,160 - INFO - ğŸ“¥ Downloading taxi_zones.zip...
2025-09-27 14:59:14,636 - INFO - âœ… Downloaded: taxi_zones.zip
2025-09-27 14:59:14,685 - INFO - âœ… Extracted shapefile components
2025-09-27 14:59:14,687 - INFO - ğŸ—‘ï¸ Cleaned up ZIP file
2025-09-27 14:59:14,692 - INFO - âœ… All taxi zone reference data files are available
2025-09-27 14:59:14,710 - INFO - âœ… Loaded 263 taxi zones from CSV
2025-09-27 14:59:14,711 - INFO - ğŸ—ºï¸ Loading taxi zone shapes...
2025-09-27 14:59:14,959 - INFO - âœ… Loaded 263 taxi zone shapes
2025-09-27 14:59:14,959 - INFO - ğŸ“š Reloading lookup tables...
2025-09-27 14:59:14,967 - INFO - âœ… Lookup tables reloaded
2025-09-27 14:59:14,968 - INFO - ğŸŒŸ Populating star schema dimensions...
2025-09-27 14:59:14,968 - INFO - ğŸŒŸ Starting star schema dimension population...
2025-09-27 14:59:14,968 - INFO - ğŸ“ Populating dim_locations...
2025-09-27 14:59:14,970 - INFO - ğŸš— Populating dim_vendor...
2025-09-27 14:59:14,971 - INFO - ğŸ’³ Populating dim_payment_type...
2025-09-27 14:59:14,971 - INFO - ğŸ“Š Populating dim_rate_code...
2025-09-27 14:59:14,998 - INFO - âœ… Star schema dimensions populated successfully!
2025-09-27 14:59:14,999 - INFO - ğŸš• Step 3: Loading Complete Trip Data
2025-09-27 14:59:14,999 - INFO - ğŸš• Loading trip data...
2025-09-27 14:59:14,999 - INFO - ğŸ”„ Backfill mode enabled: 2024-09,2024-10,2024-11,2024-12,2025-01,2025-02,2025-03,2025-04,2025-05,2025-06,2025-07,2025-08
2025-09-27 14:59:14,999 - INFO - ğŸ“… Backfill months: 12 months from (2024, 9) to (2025, 8)
2025-09-27 14:59:15,001 - INFO - ğŸ“… Processing 2024-09...
2025-09-27 14:59:15,005 - INFO - ğŸ“¥ Downloading yellow_tripdata_2024-09.parquet from NYC TLC...
2025-09-27 14:59:16,047 - INFO - ğŸ“¥ Progress: 17.1% (10,485,760/61,170,186 bytes)
2025-09-27 14:59:17,061 - INFO - ğŸ“¥ Progress: 34.3% (20,971,520/61,170,186 bytes)
2025-09-27 14:59:18,063 - INFO - ğŸ“¥ Progress: 51.4% (31,457,280/61,170,186 bytes)
2025-09-27 14:59:19,061 - INFO - ğŸ“¥ Progress: 68.6% (41,943,040/61,170,186 bytes)
2025-09-27 14:59:20,065 - INFO - ğŸ“¥ Progress: 85.7% (52,428,800/61,170,186 bytes)
2025-09-27 14:59:20,900 - INFO - âœ… Downloaded: yellow_tripdata_2024-09.parquet (61,170,186 bytes)
2025-09-27 14:59:20,905 - INFO - ğŸ“ Started processing log for 2024-09
2025-09-27 14:59:20,905 - INFO - ğŸ“¥ Loading yellow_tripdata_2024-09.parquet...
2025-09-27 14:59:21,304 - INFO - ğŸ“Š File contains 3,633,030 rows
2025-09-27 14:59:21,895 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 14:59:22,066 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 14:59:55,795 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 14:59:55,964 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:00:29,382 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:00:29,554 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:01:01,925 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:01:02,106 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:01:36,033 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:01:36,202 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:02:10,037 - INFO - ğŸ“¥ yellow_tripdata_2024-09.parquet: Processed 50,000 rows - Loaded: 50,000 normalized, 50,000 star, 0 duplicates, 0 invalid (5/364 chunks)
2025-09-27 15:02:10,037 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:02:10,204 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:02:44,127 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:02:44,316 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:03:17,988 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:03:18,154 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:03:51,743 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:03:51,914 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:04:24,861 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:04:25,048 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:04:58,627 - INFO - ğŸ“¥ yellow_tripdata_2024-09.parquet: Processed 100,000 rows - Loaded: 100,000 normalized, 100,000 star, 0 duplicates, 0 invalid (10/364 chunks)
2025-09-27 15:04:58,628 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:04:58,793 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:05:32,786 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:05:32,953 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:06:07,015 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:06:07,220 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:06:41,499 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:06:41,667 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:07:15,666 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:07:15,836 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:07:48,675 - INFO - ğŸ“¥ yellow_tripdata_2024-09.parquet: Processed 150,000 rows - Loaded: 150,000 normalized, 150,000 star, 0 duplicates, 0 invalid (15/364 chunks)
2025-09-27 15:07:48,675 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:07:48,846 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:08:22,995 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:08:23,165 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:08:57,835 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:08:58,032 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:09:32,085 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:09:32,256 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:10:06,170 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:10:06,338 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:10:40,093 - INFO - ğŸ“¥ yellow_tripdata_2024-09.parquet: Processed 200,000 rows - Loaded: 200,000 normalized, 200,000 star, 0 duplicates, 0 invalid (20/364 chunks)
2025-09-27 15:10:40,094 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:10:40,262 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:11:13,052 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:11:13,220 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:11:47,251 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:11:47,420 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:12:21,202 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:12:21,374 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:12:55,342 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:12:55,512 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:13:29,727 - INFO - ğŸ“¥ yellow_tripdata_2024-09.parquet: Processed 250,000 rows - Loaded: 250,000 normalized, 250,000 star, 0 duplicates, 0 invalid (25/364 chunks)
2025-09-27 15:13:29,728 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:13:29,904 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:14:03,922 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:14:04,095 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:14:36,714 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:14:36,886 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:15:10,639 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:15:10,826 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:15:44,513 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:15:44,695 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:16:18,504 - INFO - ğŸ“¥ yellow_tripdata_2024-09.parquet: Processed 300,000 rows - Loaded: 300,000 normalized, 300,000 star, 0 duplicates, 0 invalid (30/364 chunks)
2025-09-27 15:16:18,505 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:16:18,676 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:16:52,518 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:16:52,690 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:17:19,481 - WARNING - âš ï¸ Failed to store invalid row: (psycopg2.ProgrammingError) can't adapt type 'numpy.int32'
[SQL: 
                INSERT INTO nyc_taxi.yellow_taxi_trips_invalid (
                    error_message, error_type, source_file, chunk_number, row_number_in_chunk,
                    vendorid, tpep_pickup_datetime, tpep_dropoff_datetime, passenger_count,
                    trip_distance, ratecodeid, store_and_fwd_flag, pulocationid, dolocationid,
                    payment_type, fare_amount, extra, mta_tax, tip_amount, tolls_amount,
                    improvement_surcharge, total_amount, congestion_surcharge, airport_fee,
                    cbd_congestion_fee, row_hash, raw_data_json
                ) VALUES (
                    %(error_message)s, %(error_type)s, %(source_file)s, %(chunk_number)s, %(row_number_in_chunk)s,
                    %(vendorid)s, %(tpep_pickup_datetime)s, %(tpep_dropoff_datetime)s, %(passenger_count)s,
                    %(trip_distance)s, %(ratecodeid)s, %(store_and_fwd_flag)s, %(pulocationid)s, %(dolocationid)s,
                    %(payment_type)s, %(fare_amount)s, %(extra)s, %(mta_tax)s, %(tip_amount)s, %(tolls_amount)s,
                    %(improvement_surcharge)s, %(total_amount)s, %(congestion_surcharge)s, %(airport_fee)s,
                    %(cbd_congestion_fee)s, %(row_hash)s, %(raw_data_json)s
                )
            ]
[parameters: {'error_message': '(psycopg2.errors.CheckViolation) no partition of relation "fact_taxi_trips" found for row\nDETAIL:  Partition key of the failing row contains (pickup ... (209 characters truncated) ...                             pickup_location_key, dropoff_location_key, vendor_key, payment_type_key, rate_code_key,\n                                ', 'error_type': 'partition_constraint_violation', 'source_file': 'star_schema_fact_taxi_trips', 'chunk_number': 0, 'row_number_in_chunk': 7823, 'vendorid': 2, 'tpep_pickup_datetime': Timestamp('2008-12-31 23:05:26'), 'tpep_dropoff_datetime': Timestamp('2009-01-01 19:10:54'), 'passenger_count': 1.0, 'trip_distance': 17.86, 'ratecodeid': 2.0, 'store_and_fwd_flag': 'N', 'pulocationid': 132, 'dolocationid': 100, 'payment_type': 1, 'fare_amount': 70.0, 'extra': 5.0, 'mta_tax': 0.5, 'tip_amount': 17.54, 'tolls_amount': 6.94, 'improvement_surcharge': 1.0, 'total_amount': 105.23, 'congestion_surcharge': 2.5, 'airport_fee': 1.75, 'cbd_congestion_fee': 0, 'row_hash': 'ee0c9b5f29a61be5720349e300dd1046e1ff09be476d0f74d49a75c948a17223', 'raw_data_json': '{"vendorid": "2", "tpep_pickup_datetime": "2008-12-31 23:05:26", "tpep_dropoff_datetime": "2009-01-01 19:10:54", "passenger_count": 1.0, "trip_distan ... (280 characters truncated) ... tion_surcharge": 2.5, "airport_fee": 1.75, "cbd_congestion_fee": "0", "row_hash": "ee0c9b5f29a61be5720349e300dd1046e1ff09be476d0f74d49a75c948a17223"}'}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-27 15:17:26,711 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:17:26,880 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:17:59,713 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:17:59,884 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:18:33,812 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:18:33,984 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:19:08,050 - INFO - ğŸ“¥ yellow_tripdata_2024-09.parquet: Processed 350,000 rows - Loaded: 350,000 normalized, 349,999 star, 0 duplicates, 0 invalid (35/364 chunks)
2025-09-27 15:19:08,050 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:19:08,229 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:19:42,208 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:19:42,390 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:20:16,333 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:20:16,505 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:20:50,701 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:20:50,872 - INFO - âœ… Generated 10,000 unique row hashes
2025-09-27 15:21:23,464 - INFO - ğŸ” Calculating row hashes for duplicate prevention...
2025-09-27 15:21:23,667 - INFO - âœ… Generated 10,000 unique row hashes
